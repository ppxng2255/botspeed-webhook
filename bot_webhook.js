const express = require("express");
const bodyParser = require("body-parser");

const app = express();
app.use(bodyParser.json());

// ðŸ”¹ à¸à¸³à¸«à¸™à¸”à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”à¸¥à¸‡à¹ƒà¸™à¸ à¸¹à¸¡à¸´à¸ à¸²à¸„
const regions = {
    "à¹€à¸«à¸™à¸·à¸­": ["à¹€à¸Šà¸µà¸¢à¸‡à¹ƒà¸«à¸¡à¹ˆ", "à¹€à¸Šà¸µà¸¢à¸‡à¸£à¸²à¸¢", "à¸¥à¸³à¸›à¸²à¸‡", "à¸¥à¸³à¸žà¸¹à¸™", "à¹à¸¡à¹ˆà¸®à¹ˆà¸­à¸‡à¸ªà¸­à¸™", "à¹à¸žà¸£à¹ˆ", "à¸™à¹ˆà¸²à¸™", "à¸žà¸°à¹€à¸¢à¸²", "à¸­à¸¸à¸•à¸£à¸”à¸´à¸•à¸–à¹Œ"],
    "à¸à¸¥à¸²à¸‡": ["à¸à¸£à¸¸à¸‡à¹€à¸—à¸žà¸¡à¸«à¸²à¸™à¸„à¸£", "à¸™à¸™à¸—à¸šà¸¸à¸£à¸µ", "à¸›à¸—à¸¸à¸¡à¸˜à¸²à¸™à¸µ", "à¸ªà¸¡à¸¸à¸—à¸£à¸›à¸£à¸²à¸à¸²à¸£", "à¸žà¸£à¸°à¸™à¸„à¸£à¸¨à¸£à¸µà¸­à¸¢à¸¸à¸˜à¸¢à¸²", "à¸™à¸„à¸£à¸›à¸à¸¡"],
    "à¸­à¸µà¸ªà¸²à¸™": ["à¸‚à¸­à¸™à¹à¸à¹ˆà¸™", "à¸™à¸„à¸£à¸£à¸²à¸Šà¸ªà¸µà¸¡à¸²", "à¸­à¸¸à¸šà¸¥à¸£à¸²à¸Šà¸˜à¸²à¸™à¸µ", "à¸­à¸¸à¸”à¸£à¸˜à¸²à¸™à¸µ", "à¸¡à¸«à¸²à¸ªà¸²à¸£à¸„à¸²à¸¡", "à¸šà¸¸à¸£à¸µà¸£à¸±à¸¡à¸¢à¹Œ"],
    "à¹ƒà¸•à¹‰": ["à¸ à¸¹à¹€à¸à¹‡à¸•", "à¸ªà¸¸à¸£à¸²à¸©à¸Žà¸£à¹Œà¸˜à¸²à¸™à¸µ", "à¸ªà¸‡à¸‚à¸¥à¸²", "à¸•à¸£à¸±à¸‡", "à¸™à¸£à¸²à¸˜à¸´à¸§à¸²à¸ª", "à¸¢à¸°à¸¥à¸²"],
    "à¸•à¸°à¸§à¸±à¸™à¸­à¸­à¸": ["à¸Šà¸¥à¸šà¸¸à¸£à¸µ", "à¸£à¸°à¸¢à¸­à¸‡", "à¸ˆà¸±à¸™à¸—à¸šà¸¸à¸£à¸µ", "à¸•à¸£à¸²à¸”", "à¸‰à¸°à¹€à¸Šà¸´à¸‡à¹€à¸—à¸£à¸²"],
    "à¸•à¸°à¸§à¸±à¸™à¸•à¸": ["à¸à¸²à¸à¸ˆà¸™à¸šà¸¸à¸£à¸µ", "à¸£à¸²à¸Šà¸šà¸¸à¸£à¸µ", "à¹€à¸žà¸Šà¸£à¸šà¸¸à¸£à¸µ", "à¸›à¸£à¸°à¸ˆà¸§à¸šà¸„à¸µà¸£à¸µà¸‚à¸±à¸™à¸˜à¹Œ"]
};

// ðŸ”¹ à¹à¸¡à¸›à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸›à¸¢à¸±à¸‡à¸£à¸°à¸”à¸±à¸šà¸à¸²à¸£à¹ƒà¸Šà¹‰à¹€à¸™à¹‡à¸•
const usageLevels = {
    "à¸”à¸¹à¸«à¸™à¸±à¸‡": "à¸¡à¸²à¸",
    "à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¡": "à¸¡à¸²à¸",
    "à¹€à¸£à¸µà¸¢à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ": "à¸¡à¸²à¸",
    "à¸—à¸³à¸‡à¸²à¸™": "à¸›à¸²à¸™à¸à¸¥à¸²à¸‡",
    "à¹‚à¸‹à¹€à¸Šà¸µà¸¢à¸¥à¸¡à¸µà¹€à¸”à¸µà¸¢": "à¸™à¹‰à¸­à¸¢",
    "à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œ": "à¸™à¹‰à¸­à¸¢"
};

// ðŸ”¹ à¹à¸¡à¸›à¹à¸™à¸°à¸™à¸³à¹à¸žà¹‡à¸à¹€à¸à¸ˆà¸­à¸´à¸™à¹€à¸—à¸­à¸£à¹Œà¹€à¸™à¹‡à¸•à¸•à¸²à¸¡à¸ à¸¹à¸¡à¸´à¸ à¸²à¸„à¹à¸¥à¸°à¸£à¸°à¸”à¸±à¸šà¸à¸²à¸£à¹ƒà¸Šà¹‰à¹€à¸™à¹‡à¸•
const recommendations = {
    "à¹€à¸«à¸™à¸·à¸­": {
        "à¸¡à¸²à¸": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **True 5G Ultra Max** à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸šà¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸«à¸™à¸±à¸à¹ƒà¸™à¸ à¸²à¸„à¹€à¸«à¸™à¸·à¸­ ðŸš€",
        "à¸›à¸²à¸™à¸à¸¥à¸²à¸‡": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **AIS Work Pro** à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¹à¸¥à¸°à¹€à¸£à¸µà¸¢à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ ðŸ’¼",
        "à¸™à¹‰à¸­à¸¢": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **Dtac Social Hero** à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹‚à¸‹à¹€à¸Šà¸µà¸¢à¸¥à¹„à¸”à¹‰à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸°à¸”à¸¸à¸” ðŸ“±"
    },
    "à¸à¸¥à¸²à¸‡": {
        "à¸¡à¸²à¸": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **AIS Max Speed 5G** à¸—à¸µà¹ˆà¹€à¸ªà¸–à¸µà¸¢à¸£à¹à¸¥à¸°à¹€à¸£à¹‡à¸§à¸ªà¸¸à¸”à¹ƒà¸™à¸ à¸²à¸„à¸à¸¥à¸²à¸‡ âš¡",
        "à¸›à¸²à¸™à¸à¸¥à¸²à¸‡": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **AIS Business Fiber** à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸šà¹‰à¸²à¸™ ðŸ¡",
        "à¸™à¹‰à¸­à¸¢": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **Dtac Unlimited Social** à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸¥à¹ˆà¸™à¹‚à¸‹à¹€à¸Šà¸µà¸¢à¸¥à¸—à¸¸à¸à¸§à¸±à¸™ ðŸ“²"
    },
    "à¸­à¸µà¸ªà¸²à¸™": {
        "à¸¡à¸²à¸": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **Dtac Turbo Gaming** à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸šà¸à¸²à¸£à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¡à¹ƒà¸™à¸ à¸²à¸„à¸­à¸µà¸ªà¸²à¸™ ðŸŽ®",
        "à¸›à¸²à¸™à¸à¸¥à¸²à¸‡": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **True Business Fiber** à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¹à¸¥à¸°à¹€à¸£à¸µà¸¢à¸™à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ ðŸ’»",
        "à¸™à¹‰à¸­à¸¢": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **AIS Social Plus** à¸—à¸µà¹ˆà¹€à¸¥à¹ˆà¸™à¹‚à¸‹à¹€à¸Šà¸µà¸¢à¸¥à¹„à¸”à¹‰à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¸µà¸”à¸ˆà¸³à¸à¸±à¸” ðŸ¤³"
    },
    "à¹ƒà¸•à¹‰": {
        "à¸¡à¸²à¸": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **True 5G Super Max** à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¡à¹à¸¥à¸°à¸”à¸¹à¸«à¸™à¸±à¸‡à¹ƒà¸™à¸ à¸²à¸„à¹ƒà¸•à¹‰ ðŸŽ¥",
        "à¸›à¸²à¸™à¸à¸¥à¸²à¸‡": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **AIS Work Anywhere** à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸³à¸‡à¸²à¸™à¸£à¸°à¸¢à¸°à¹„à¸à¸¥ âœ¨",
        "à¸™à¹‰à¸­à¸¢": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **Dtac Social Everywhere** à¸—à¸µà¹ˆà¹€à¸¥à¹ˆà¸™à¹‚à¸‹à¹€à¸Šà¸µà¸¢à¸¥à¹„à¸”à¹‰à¸—à¸¸à¸à¸—à¸µà¹ˆ ðŸ"
    },
    "à¸•à¸°à¸§à¸±à¸™à¸­à¸­à¸": {
        "à¸¡à¸²à¸": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **AIS 5G Ultimate Stream** à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸”à¸¹à¸«à¸™à¸±à¸‡ 4K à¹à¸¥à¸°à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¡ ðŸŒŠ",
        "à¸›à¸²à¸™à¸à¸¥à¸²à¸‡": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **True Work Pro** à¸—à¸µà¹ˆà¹€à¸ªà¸–à¸µà¸¢à¸£à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™ ðŸ’¼",
        "à¸™à¹‰à¸­à¸¢": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **Dtac Lite Social** à¸ªà¸³à¸«à¸£à¸±à¸šà¸„à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸Šà¹‰à¹€à¸™à¹‡à¸•à¹€à¸šà¸²à¹† ðŸ“Œ"
    },
    "à¸•à¸°à¸§à¸±à¸™à¸•à¸": {
        "à¸¡à¸²à¸": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **AIS 5G Speed Boost** à¸—à¸µà¹ˆà¹€à¸£à¹‡à¸§à¸ªà¸¸à¸”à¹ƒà¸™à¸ à¸²à¸„à¸•à¸°à¸§à¸±à¸™à¸•à¸ ðŸš„",
        "à¸›à¸²à¸™à¸à¸¥à¸²à¸‡": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **True Work Home** à¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸š Work From Home ðŸ ",
        "à¸™à¹‰à¸­à¸¢": "Speedà¹‚à¸¡à¹ˆà¹à¸™à¸°à¸™à¸³ **AIS Basic Social** à¸—à¸µà¹ˆà¹€à¸¥à¹ˆà¸™à¹‚à¸‹à¹€à¸Šà¸µà¸¢à¸¥à¹„à¸”à¹‰à¸ªà¸šà¸²à¸¢à¹† ðŸ“²"
    }
};

// ðŸ”¹ Webhook Endpoint à¸ªà¸³à¸«à¸£à¸±à¸š Dialogflow
app.post("/webhook", (req, res) => {
    const intent = req.body.queryResult.intent.displayName;
    const parameters = req.body.queryResult.parameters;

    let responseText = "à¸‚à¸­à¸­à¸ à¸±à¸¢à¸„à¹ˆà¸° Speedà¹‚à¸¡à¹ˆà¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸„à¸³à¸‚à¸­à¸‚à¸­à¸‡à¸„à¸¸à¸“ ðŸ˜¢";

    if (intent === "ask_location") {
        const location = parameters.location || "à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸";
        responseText = `à¹‚à¸­à¹€à¸„à¸„à¹ˆà¸°! à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸Šà¹‰à¹€à¸™à¹‡à¸•à¸—à¸µà¹ˆ ${location} à¸”à¹‰à¸²à¸™à¹„à¸«à¸™? (à¸”à¸¹à¸«à¸™à¸±à¸‡, à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¡, à¸—à¸³à¸‡à¸²à¸™, à¸¯à¸¥à¸¯)`;
    } 
    else if (intent === "ask_types") {
        const location = parameters.location || "à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸";
        const usage = parameters.usage || "à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸";

        // à¸«à¸²à¸ à¸¹à¸¡à¸´à¸ à¸²à¸„à¸‚à¸­à¸‡à¸ˆà¸±à¸‡à¸«à¸§à¸±à¸”
        let region = "default";
        for (const [key, value] of Object.entries(regions)) {
            if (value.includes(location)) {
                region = key;
                break;
            }
        }

        // à¸à¸³à¸«à¸™à¸”à¸£à¸°à¸”à¸±à¸šà¸à¸²à¸£à¹ƒà¸Šà¹‰à¹€à¸™à¹‡à¸•
        const usageLevel = usageLevels[usage] || "default";

        // à¸”à¸¶à¸‡à¹à¸žà¹‡à¸à¹€à¸à¸ˆà¹à¸™à¸°à¸™à¸³
        responseText = recommendations[region]?.[usageLevel] || "Speedà¹‚à¸¡à¹ˆ à¸‚à¸­à¹à¸™à¸°à¸™à¸³ AIS 5G à¸«à¸£à¸·à¸­ True 5Gà¸„à¹ˆà¸° à¸—à¸µà¹ˆà¸£à¸­à¸‡à¸£à¸±à¸šà¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸—à¸¸à¸à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¸„à¹ˆà¸°!";
    }

    res.json({ fulfillmentText: responseText });
});

// ðŸ”¹ à¹€à¸›à¸´à¸”à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œ
const PORT = process.env.PORT || 5000;
app.listen(PORT, () => {
    console.log(` Server is running on port ${PORT}`);
});
